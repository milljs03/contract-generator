<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Proposal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Link to the dedicated view.css file -->
    <link rel="stylesheet" href="view.css">
    <!-- Add Google Font for Cursive -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 font-inter">

    <!-- Loading State -->
    <div id="loading-state" class="min-h-screen flex items-center justify-center">
        <div class="text-center">
            <svg class="animate-spin h-8 w-8 text-blue-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-2 font-medium text-gray-600">Loading Contract...</p>
        </div>
    </div>

    <!-- Error State -->
    <div id="error-state" class="min-h-screen flex items-center justify-center hidden">
         <div class="bg-white p-8 rounded-lg shadow-md text-center max-w-lg">
            <h1 class="text-2xl font-bold mb-4 text-red-600">Contract Not Found</h1>
            <p class="text-gray-700">The contract link appears to be invalid or expired. Please contact your account representative for a new link.</p>
        </div>
    </div>

    <!-- Main Contract View -->
    <div id="contract-view" class="hidden max-w-5xl mx-auto my-12 p-8 md:p-12 bg-white shadow-2xl rounded-lg">

        <!-- Header -->
        <header class="mb-8 pb-4 border-b">
            <h1 class="text-3xl font-bold text-gray-900">Service Agreement</h1>
            <p class="text-lg text-gray-600">Proposal For: <span id="view-business-name" class="font-semibold text-gray-800"></span></p>
        </header>

        <!-- Contract Details -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 text-sm">
            <div class="view-detail-box">
                <h4 class="view-detail-title">Prepared For</h4>
                <p id="detail-business-name"></p>
                <p id="detail-agent-name" class="hidden"></p>
            </div>
            <div class="view-detail-box">
                <h4 class="view-detail-title">Customer Email</h4>
                <p id="detail-customer-email"></p>
            </div>
            <div class="view-detail-box">
                <h4 class="view-detail-title">Service Address(es)</h4>
                <ul id="detail-service-addresses" class="list-disc list-inside">
                    <!-- JS will populate this -->
                </ul>
            </div>
            <div class="view-detail-box">
                <h4 class="view-detail-title">Billing Address</h4>
                <p id="detail-billing-address"></p>
            </div>
        </div>

        <!-- REMOVED Installation Schedule Display Div -->

        <!-- Contract Options -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Please Select an Option:</h2>
            <div id="options-view-container" class="space-y-6">
                <!-- JS will populate options here -->
            </div>
        </div>

        <!-- Terms of Service Section -->
        <div id="terms-section" class="mb-8">
             <details class="terms-details bg-gray-50 border rounded-md">
                 <summary class="terms-summary">
                     View Terms of Agreement
                 </summary>
                 <div class="terms-content">
                     <h3 class="font-semibold text-lg mb-2">Terms of Agreement</h3>

                     <h4 class="font-medium mt-4 mb-1">Detail of Services</h4>
                     <ol class="list-decimal list-inside space-y-1 text-sm">
                         <li>Customer is responsible for all equipment, networks, or otherwise beyond the termination point(s) installed by the Community Fiber Network (CFN).</li>
                         <li>This quote is for the services included herein and for the term selected on the signature page. Prices include all access charges and surcharges, excluding applicable sales tax.</li>
                         <li>CFN will provide installation and support of CFN-owned equipment. CFN will provide data services support for requests involving CFN services and within the scope of CFN's business offerings.</li>
                         <li>CFN will provide pertinent information to the Customer or their vendor (e.g., username/password, IP information, configuration details) as deemed necessary by CFN for proper service function.</li>
                         <li>CFN does not support hardware or software provided by other vendors.</li>
                         <li>(If applicable) This agreement supersedes any previous agreement for the relevant location(s). Any early termination penalties from a previous agreement may be incorporated into the NRC of this proposal as agreed upon by CFN and Customer.</li>
                     </ol>

                     <h4 class="font-medium mt-4 mb-1">Security & Privacy</h4>
                     <ol class="list-decimal list-inside space-y-1 text-sm">
                         <li>CFN acts as a service provider. Customers are advised to discuss their computing environment, network structure, and security needs with their hardware/software vendor or internal IT personnel.</li>
                         <li>CFN will use commercially reasonable efforts to maintain the security of its underlying network, systems, services, and associated customer information. CFN does not sell, advertise, or solicit for sale its customer lists or contact information.</li>
                     </ol>

                     <h4 class="font-medium mt-4 mb-1">Installation Schedule</h4>
                     <ol class="list-decimal list-inside space-y-1 text-sm">
                         <!-- ADDED id and REMOVED static text -->
                         <li id="dynamic-installation-schedule" class="whitespace-pre-line">
                            <!-- JS will populate this -->
                         </li>
                     </ol>

                     <h4 class="font-medium mt-4 mb-1">Billing</h4>
                     <ol class="list-decimal list-inside space-y-1 text-sm">
                         <li>CFN bills for services one month in advance. The initial invoice will include applicable installation fees (NRC), prorated service charges for the first month (from the service activation date), and service charges for the following full month in advance.</li>
                         <li>Pricing is subject to change under the terms of this agreement. However, the Monthly Recurring Charges (MRC) stated in the selected option are guaranteed not to increase during the initial contract term.</li>
                     </ol>

                     <h4 class="font-medium mt-4 mb-1">Term</h4>
                     <ol class="list-decimal list-inside space-y-1 text-sm">
                         <li>The term of this agreement commences upon the execution (signing) of this document and continues for the duration specified in the selected option.</li>
                     </ol>

                     <h4 class="font-medium mt-4 mb-1">Termination (Post-Term)</h4>
                     <ol class="list-decimal list-inside space-y-1 text-sm">
                         <li>Upon completion of the initial contract term, the Customer may cancel services by providing 30 days' written notice to CFN, with no cancellation fee, provided all outstanding balances are paid.</li>
                     </ol>

                     <p class="text-sm mt-4 italic">This quote is valid for 30 business days from the date generated unless otherwise stated.</p>

                     <hr class="my-4">

                     <h3 class="font-semibold text-lg mb-2">Additional Terms</h3>

                     <h4 class="font-medium mt-4 mb-1">Early Termination</h4>
                     <ol class="list-decimal list-inside space-y-1 text-sm">
                         <li>If the Customer terminates services before the expiration of the initial contract term, an early termination fee (ETF) will apply. The ETF is calculated as 50% of the Monthly Recurring Charge (MRC) for the selected option, multiplied by the number of months remaining in the unfulfilled term. Additionally, a $600 fee may apply for failure to return CFN-installed customer premise equipment (CPE). This equipment fee will be waived if the Customer cooperates with CFN to schedule and complete the removal of the CPE. (Example: Terminating a $800/month contract with 6 months remaining incurs an ETF of $2400 (6 months * $800 * 0.5), provided the equipment is returned).</li>
                     </ol>

                     <h4 class="font-medium mt-4 mb-1">Default</h4>
                     <ol class="list-decimal list-inside space-y-1 text-sm">
                         <li>Customer shall be deemed in default upon failure to pay any amount due within thirty (30) days of the due date. Upon default, CFN may, at its option and with 14 days prior written notice, terminate all services provided under this agreement.</li>
                     </ol>

                      <h4 class="font-medium mt-4 mb-1">Contact</h4>
                     <ol class="list-decimal list-inside space-y-1 text-sm">
                         <li>Please contact your CFN representative if you have questions regarding this proposal or require modifications.</li>
                     </ol>
                 </div>
             </details>
        </div>

        <!-- Signature Section -->
        <div id="signature-section" class="mt-12 pt-8 border-t">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Agreement & Signature</h2>

            <div class="mb-4 text-sm text-gray-700 space-y-2">
                <p>By signing below, you acknowledge that you have read and agree to the <span class="font-medium">Terms of Agreement</span> outlined above and the details of the selected option.</p>
                <p class="font-semibold">Your selected option: <span id="selected-option-title" class="text-blue-600">None</span></p>
            </div>

            <!-- Printed Name -->
            <div class="mb-4">
                <label for="signer-name" class="form-label">Printed Name</label>
                <input type="text" id="signer-name" class="form-input">
            </div>

            <!-- Signature Type Choice -->
            <div class="mb-4">
                <input type="checkbox" id="use-typed-signature" class="form-checkbox">
                <label for="use-typed-signature" class="ml-2 text-sm text-gray-700">Use typed name as signature (renders as cursive)</label>
            </div>

            <!-- Signature Area (Canvas or Typed) -->
            <div class="signature-area">
                <label class="form-label">Signature:</label>
                <!-- Canvas (Initially Visible) -->
                <div id="signature-canvas-container">
                    <canvas id="signature-pad" class="border border-gray-400 rounded-md w-full h-48 bg-gray-50"></canvas>
                    <button id="clear-signature-btn" type="button" class="text-sm text-blue-600 hover:underline mt-1">Clear Signature</button>
                </div>
                <!-- Typed Cursive Display (Initially Hidden) -->
                <div id="typed-signature-display" class="hidden border border-gray-300 rounded-md w-full h-48 p-4 bg-gray-50 flex items-center justify-center">
                    <span id="typed-signature-text" class="typed-signature-font text-3xl text-gray-800"></span>
                </div>
            </div>

            <div class="mt-8 text-right">
                <button id="accept-contract-btn" class="btn btn-primary btn-lg" disabled>
                    Select an Option to Sign
                </button>
            </div>
        </div>

        <!-- Thank You / Locked State -->
        <div id="thank-you-state" class="hidden mt-12 p-8 bg-green-50 border-l-4 border-green-500 rounded-md">
            <h2 class="text-2xl font-bold text-green-800">Thank You!</h2>
            <p class="mt-2 text-gray-700">This contract was signed by <strong id="signed-by-name"></strong> on <strong id="signed-on-date"></strong>.</p>
            <p class="mt-1 text-gray-600">This document is now locked. Please contact your account representative if you have any questions.</p>
            <div id="final-signature-display" class="mt-4">
                 <h4 class="font-medium text-gray-700 mb-1">Signature Provided:</h4>
                 <!-- JS will populate this -->
            </div>
        </div>

    </div>

    <!-- Signature Pad Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
    <!-- MOVED SCRIPT TAGS TO THE END -->
    <script type="module" src="firebase.js"></script>
    <script type="module" src="view.js"></script>
</body>
</html>

